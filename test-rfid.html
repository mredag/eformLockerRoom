<!DOCTYPE html>
<html>
<head>
    <title>RFID Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .info { background: #e3f2fd; border: 1px solid #2196f3; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        #output { background: #f5f5f5; padding: 10px; border: 1px solid #ccc; min-height: 200px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç RFID Reader Test</h1>
    <div class="status info">
        <strong>Instructions:</strong>
        <ol>
            <li>Click in the text area below to focus it</li>
            <li>Scan your RFID card</li>
            <li>Watch the output for detected input</li>
        </ol>
    </div>
    
    <div class="status" id="status">Ready for RFID input...</div>
    
    <h3>RFID Input Area (click here first):</h3>
    <textarea id="rfidInput" placeholder="Click here and scan your RFID card..." style="width: 100%; height: 100px; font-size: 16px;"></textarea>
    
    <h3>Debug Output:</h3>
    <div id="output"></div>
    
    <script>
        let rfidBuffer = '';
        let rfidTimeout = null;
        const output = document.getElementById('output');
        const status = document.getElementById('status');
        const rfidInput = document.getElementById('rfidInput');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `[${timestamp}] ${message}<br>`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        log('üîß RFID Test initialized');
        updateStatus('Ready - Click in text area and scan RFID card');
        
        // Listen for all keyboard events
        document.addEventListener('keydown', (event) => {
            log(`üîç Key detected: "${event.key}" (code: ${event.code})`);
            
            // Handle Enter key (end of RFID scan)
            if (event.key === 'Enter') {
                if (rfidBuffer.length > 0) {
                    log(`üéØ RFID Card Detected: "${rfidBuffer}"`);
                    updateStatus(`RFID Card: ${rfidBuffer}`, 'success');
                    rfidBuffer = '';
                } else {
                    log('‚ö†Ô∏è Enter pressed but no RFID buffer');
                }
                
                if (rfidTimeout) {
                    clearTimeout(rfidTimeout);
                    rfidTimeout = null;
                }
                return;
            }
            
            // Handle numeric and alphanumeric input
            if (event.key.length === 1 && /[A-Za-z0-9]/.test(event.key)) {
                rfidBuffer += event.key;
                log(`üìù Buffer: "${rfidBuffer}"`);
                updateStatus(`Reading card... (${rfidBuffer.length} chars)`, 'info');
                
                // Clear buffer after 3 seconds if no Enter received
                if (rfidTimeout) {
                    clearTimeout(rfidTimeout);
                }
                
                rfidTimeout = setTimeout(() => {
                    log('‚è∞ RFID input timeout - clearing buffer');
                    rfidBuffer = '';
                    updateStatus('Timeout - Ready for next scan', 'error');
                    rfidTimeout = null;
                }, 3000);
            }
        });
        
        // Also monitor the text area for input
        rfidInput.addEventListener('input', (event) => {
            log(`üìÑ Text area input: "${event.target.value}"`);
        });
        
        rfidInput.addEventListener('keydown', (event) => {
            log(`üìÑ Text area key: "${event.key}"`);
        });
        
        log('‚úÖ Event listeners ready');
    </script>
</body>
</html>
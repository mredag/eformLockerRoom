<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Durumu - eForm Locker System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .metric-card {
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .metric-trend {
            font-size: 0.9rem;
        }
        .refresh-indicator {
            opacity: 0;
            transition: opacity 0.3s;
        }
        .refresh-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/lockers">
                <i class="fas fa-chart-line me-2"></i>
                Sistem Durumu
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/lockers">
                    <i class="fas fa-boxes me-1"></i>
                    Dolaplar
                </a>
                <a class="nav-link" href="/relay">
                    <i class="fas fa-toggle-on me-1"></i>
                    Röle Kontrolü
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Hardware Status Row -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-microchip text-danger mb-2" style="font-size: 2rem;"></i>
                        <h5 class="card-title">CPU Kullanımı</h5>
                        <div class="metric-value text-danger" id="cpu-load">--%</div>
                        <div class="metric-trend" id="cpu-cores">
                            <span id="cpu-cores-text">Anlık Yük</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-memory text-info mb-2" style="font-size: 2rem;"></i>
                        <h5 class="card-title">RAM Kullanımı</h5>
                        <div class="metric-value text-info" id="ram-usage">-- / -- MB</div>
                        <div class="metric-trend" id="ram-percent">
                            <span id="ram-percent-text">--% dolu</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card metric-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-thermometer-half text-warning mb-2" style="font-size: 2rem;"></i>
                        <h5 class="card-title">Sıcaklık</h5>
                        <div class="metric-value text-warning" id="cpu-temp">--°C</div>
                        <div class="metric-trend" id="cpu-temp-max">
                            <span id="cpu-temp-max-text">Max: --°C</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            updateHardwareStatus();
            
            // Auto-refresh every 30 seconds
            setInterval(updateHardwareStatus, 30000);
        });

        async function updateHardwareStatus() {
            try {
                const response = await fetch('/api/performance/hardware-status');
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                const status = await response.json();

                // CPU
                document.getElementById('cpu-load').textContent = `${status.cpu.load}%`;
                // The 'cores' text is now static, so no update needed here.

                // RAM
                document.getElementById('ram-usage').textContent = `${status.ram.used} / ${status.ram.total} MB`;
                document.getElementById('ram-percent-text').textContent = `${status.ram.percent}% dolu`;

                // Temperature
                const tempMain = status.temp.main !== null ? `${status.temp.main}°C` : 'N/A';
                const tempMax = status.temp.max !== null ? `Max: ${status.temp.max}°C` : 'Max: N/A';
                document.getElementById('cpu-temp').textContent = tempMain;
                document.getElementById('cpu-temp-max-text').textContent = tempMax;

            } catch (error) {
                console.error('Hardware status update failed:', error);
                // Display error states
                document.getElementById('cpu-load').textContent = 'Hata';
                document.getElementById('ram-usage').textContent = 'Hata';
                document.getElementById('cpu-temp').textContent = 'Hata';
            }
        }
    </script>
</body>
</html>
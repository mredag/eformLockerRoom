<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Handling Test - Task 8</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            margin: 10px;
            padding: 10px 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #1d4ed8;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #374151;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Error Handling Test - Task 8</h1>
        <p>This page tests the Turkish error messages and recovery functionality implemented in Task 8.</p>
        
        <div class="test-section">
            <h3>Error Message Tests</h3>
            <button class="test-button" onclick="testError('hardware_disconnected')">Hardware Disconnected</button>
            <button class="test-button" onclick="testError('locker_busy')">Locker Busy</button>
            <button class="test-button" onclick="testError('general_error')">General Error</button>
            <button class="test-button" onclick="testError('network_error')">Network Error</button>
            <button class="test-button" onclick="testError('system_error')">System Error</button>
        </div>
        
        <div class="test-section">
            <h3>Connection Status Tests</h3>
            <button class="test-button" onclick="testConnection('offline')">Show Offline</button>
            <button class="test-button" onclick="testConnection('reconnecting')">Show Reconnecting</button>
            <button class="test-button" onclick="testConnection('online')">Show Online</button>
        </div>
        
        <div class="test-section">
            <h3>Last Update Time Test</h3>
            <button class="test-button" onclick="testUpdateTime()">Update Timestamp</button>
        </div>
        
        <div class="test-section">
            <h3>Language Test</h3>
            <button class="test-button" onclick="testLanguage('tr')">Turkish</button>
            <button class="test-button" onclick="testLanguage('en')">English</button>
        </div>
        
        <div id="test-results" class="test-section">
            <h3>Test Results</h3>
            <div id="results-content">
                <p>Click buttons above to test functionality...</p>
            </div>
        </div>
    </div>

    <!-- Include the i18n system -->
    <script>
        // Mock i18n system for testing
        class TestI18n {
            constructor() {
                this.currentLanguage = 'tr';
                this.messages = {
                    kiosk: {
                        // Turkish error messages
                        hardware_disconnected: 'Donanƒ±m baƒülƒ± deƒüil. Sistem bakƒ±mda',
                        locker_busy: 'Dolap dolu',
                        general_error: 'ƒ∞≈ülem yapƒ±lamadƒ±',
                        network_error: 'Aƒü hatasƒ±',
                        system_error: 'Sistem hatasƒ±',
                        connection_lost: '√áevrimdƒ±≈üƒ±',
                        connection_restored: 'Yeniden baƒülandƒ±',
                        reconnecting: 'Yeniden baƒülanƒ±yor...',
                        last_update: 'Son g√ºncelleme',
                        try_different_locker: 'Farklƒ± dolap se√ßin',
                        try_again: 'Tekrar deneyin',
                        contact_staff: 'G√∂revliye ba≈üvurun'
                    }
                };
            }
            
            get(key) {
                return this.messages.kiosk[key] || key;
            }
            
            showError(errorType, recoveryType = null, duration = 5000) {
                const errorMessage = this.get(errorType);
                const recoveryMessage = recoveryType ? this.get(recoveryType) : null;
                
                let errorBanner = document.getElementById('error-banner');
                if (!errorBanner) {
                    errorBanner = document.createElement('div');
                    errorBanner.id = 'error-banner';
                    errorBanner.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        z-index: 15;
                        max-width: 600px;
                        width: 90%;
                        background: #fef2f2;
                        border: 2px solid #fecaca;
                        border-radius: 12px;
                        box-shadow: 0 8px 32px rgba(220, 38, 38, 0.2);
                        padding: 16px 20px;
                        display: flex;
                        align-items: flex-start;
                        gap: 12px;
                    `;
                    document.body.appendChild(errorBanner);
                }
                
                errorBanner.innerHTML = `
                    <div style="color: #dc2626; flex-shrink: 0; margin-top: 2px;">‚ö†Ô∏è</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 1.1rem; font-weight: 600; color: #dc2626; margin-bottom: 4px; line-height: 1.4;">
                            ${errorMessage}
                        </div>
                        ${recoveryMessage ? `<div style="font-size: 0.95rem; color: #7f1d1d; line-height: 1.3; opacity: 0.9;">${recoveryMessage}</div>` : ''}
                    </div>
                    <button onclick="this.parentElement.style.display='none'" style="background: none; border: none; color: #dc2626; cursor: pointer; padding: 4px; border-radius: 4px;">‚úï</button>
                `;
                
                errorBanner.style.display = 'flex';
                
                if (duration > 0) {
                    setTimeout(() => {
                        errorBanner.style.display = 'none';
                    }, duration);
                }
                
                logResult(`Error shown: ${errorMessage}${recoveryMessage ? ` | Recovery: ${recoveryMessage}` : ''}`, 'success');
            }
            
            showConnectionStatus(status) {
                let statusIndicator = document.getElementById('connection-status');
                if (!statusIndicator) {
                    statusIndicator = document.createElement('div');
                    statusIndicator.id = 'connection-status';
                    statusIndicator.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        z-index: 20;
                        background: rgba(0, 0, 0, 0.9);
                        color: white;
                        padding: 16px 24px;
                        border-radius: 12px;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        font-size: 1.1rem;
                        font-weight: 600;
                    `;
                    document.body.appendChild(statusIndicator);
                }
                
                let statusText, statusColor, statusIcon;
                switch (status) {
                    case 'offline':
                        statusText = this.get('connection_lost');
                        statusColor = '#fca5a5';
                        statusIcon = '‚ùå';
                        break;
                    case 'reconnecting':
                        statusText = this.get('reconnecting');
                        statusColor = '#fbbf24';
                        statusIcon = 'üîÑ';
                        break;
                    case 'online':
                        statusText = this.get('connection_restored');
                        statusColor = '#86efac';
                        statusIcon = '‚úÖ';
                        break;
                }
                
                statusIndicator.innerHTML = `
                    <span>${statusIcon}</span>
                    <span style="color: ${statusColor}">${statusText}</span>
                `;
                
                statusIndicator.style.display = 'flex';
                
                if (status === 'online') {
                    setTimeout(() => {
                        statusIndicator.style.display = 'none';
                    }, 3000);
                }
                
                logResult(`Connection status: ${statusText}`, 'success');
            }
            
            updateLastUpdateTime(timestamp = new Date()) {
                let lastUpdateElement = document.getElementById('last-update-time');
                if (!lastUpdateElement) {
                    lastUpdateElement = document.createElement('div');
                    lastUpdateElement.id = 'last-update-time';
                    lastUpdateElement.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        font-size: 0.8rem;
                        color: #6b7280;
                        background: white;
                        padding: 8px 12px;
                        border-radius: 6px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    `;
                    document.body.appendChild(lastUpdateElement);
                }
                
                const timeString = timestamp.toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                lastUpdateElement.innerHTML = `
                    <span style="opacity: 0.8;">${this.get('last_update')}:</span>
                    <span style="font-weight: 600; color: #374151;">${timeString}</span>
                `;
                
                logResult(`Last update time: ${timeString}`, 'success');
            }
            
            getErrorWithRecovery(errorType) {
                const errorMessages = {
                    hardware_disconnected: { error: 'hardware_disconnected', recovery: 'contact_staff' },
                    locker_busy: { error: 'locker_busy', recovery: 'try_different_locker' },
                    general_error: { error: 'general_error', recovery: 'try_again' },
                    network_error: { error: 'network_error', recovery: 'try_again' },
                    system_error: { error: 'system_error', recovery: 'contact_staff' }
                };
                
                const errorConfig = errorMessages[errorType] || { error: errorType, recovery: 'try_again' };
                
                return {
                    message: this.get(errorConfig.error),
                    recovery: this.get(errorConfig.recovery)
                };
            }
        }
        
        // Initialize test i18n
        window.i18n = new TestI18n();
        
        // Test functions
        function testError(errorType) {
            const errorInfo = window.i18n.getErrorWithRecovery(errorType);
            window.i18n.showError(errorType, errorInfo.recovery);
        }
        
        function testConnection(status) {
            window.i18n.showConnectionStatus(status);
        }
        
        function testUpdateTime() {
            window.i18n.updateLastUpdateTime();
        }
        
        function testLanguage(lang) {
            window.i18n.currentLanguage = lang;
            logResult(`Language set to: ${lang}`, 'success');
        }
        
        function logResult(message, type) {
            const resultsContent = document.getElementById('results-content');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${type}`;
            resultDiv.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            resultsContent.appendChild(resultDiv);
            resultsContent.scrollTop = resultsContent.scrollHeight;
        }
        
        // Initial test
        logResult('Error handling system initialized successfully', 'success');
    </script>
</body>
</html>